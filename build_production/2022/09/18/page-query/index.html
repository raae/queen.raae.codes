<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="canonical" href="https://queen.raae.codes/2022/09/18/page-query">
        <meta name="description" content="Ahoy, seasoned JavaScript developers and daring dev pirates! Join our swashbuckling crew as we embark on thrilling treasure hunts unraveling the secrets of HTML, CSS, and JavaScript, all while having a blast!">
        <title>Migration from Page Context to a Gatsby Page Query</title>
                <link rel="stylesheet" href="/assets/build/assets/main-HrG164mN.css">
        <script defer type="module" src="/assets/build/assets/main-l0sNRNKZ.js"></script>
    </head>
    <body class="text-gray-900 font-sans antialiased">
        <article class="max-w-3xl mx-auto px-4 py-8">
    <header class="mb-8">
        <h1 class="text-4xl font-bold text-brown-900 mb-4">Migration from Page Context to a Gatsby Page Query</h1>

        
                    <div class="mt-4 flex flex-wrap gap-2">
                                    <span class="px-3 py-1 bg-brown-100 text-brown-800 rounded-full text-sm">
                        page query
                    </span>
                                    <span class="px-3 py-1 bg-brown-100 text-brown-800 rounded-full text-sm">
                        page context
                    </span>
                                    <span class="px-3 py-1 bg-brown-100 text-brown-800 rounded-full text-sm">
                        page template
                    </span>
                            </div>
            </header>

    <div class="prose prose-lg prose-brown max-w-none">
        <p>Friday's guest <a href="https://twitter.com/borderless_dev">Tayler (@borderless_dev)</a> on the <a href="https://youtu.be/nNn3bAx5l9E">unauthorized and rum-fueled treasure hunt</a> in the sharky waters around the Gatsby islands is our most piratical guest to date üè¥‚Äç‚ò†Ô∏è</p>

<p><a href="https://youtu.be/nNn3bAx5l9E"><img src="./screendump.jpg" alt="Stream Screendump" /></a></p>

<blockquote>
  <p>Distribute Aid's mission is to provide for basic human needs at scale by connecting communities and empowering people to uphold human dignity.</p>
</blockquote>

<p>It ended up being a long one as we completed the refactoring for all the page templates, including some extra work needed for the third one. However, we completed the first migration within the first 30 minutes of the stream if you want to watch how!</p>

<h2>The What?</h2>

<p>Migrate <a href="https://distributeaid.org/">Distribute Aid</a>'s Gatsby site from a page context to page query approach for getting data into their page templates.</p>

<h2>The Why?</h2>

<p>Pushing all data needed by a page through the page context works and is a straightforward solution I see many developers reach for. However, you then bypass Gatsby goodness, such as hot reloading and incremental builds, by removing the connection between a node and its page.</p>

<h2>The How</h2>

<p>Instead of pushing through all data on the page context, pass only the node id. Then in the page template, use the node id to query for all data needed.</p>

<h2>The Code</h2>

<p>Before migration: pushing all data on the page context:</p>

<pre><code class="language-js">// File: gatsby-node.js
const path = require("path");

exports.createPages = async (gatsbyUtils) =&gt; {
  const { graphql, actions } = gatsbyUtils;
  const { createPage } = actions;

  const regionsQuery = await graphql(
    `
      query RegionsQuery {
        regions: allDaRegion {
          nodes {
            slug
            name
            overview
            subregions {
              name
            }
          }
        }
      }
    `
  );

  regionsQuery.data.regions.nodes.forEach((region) =&gt; {
    createPage({
      path: `/regions/${region.slug}`,
      component: path.resolve(`./src/templates/RegionPage.js`),
      context: {
        region: region,
      },
    });
  });
};
</code></pre>

<pre><code class="language-js">// File: src/templates/RegionPage.js
import { graphql } from "gatsby";

const RegionPage = ({ pageContext: { region } }) =&gt; {
  return &lt;main&gt;{JSON.stringify(region, null, 2)}&lt;/main&gt;;
};

export default RegionPage;
</code></pre>

<p>After migration, passing only the node id:</p>

<pre><code class="language-js">// File: gatsby-node.js
const path = require("path");

exports.createPages = async (gatsbyUtils) =&gt; {
  const { graphql, actions } = gatsbyUtils;
  const { createPage } = actions;

  const regionsQuery = await graphql(`
    query RegionsQuery {
      regions: allDaRegion {
        nodes {
          id
          slug
        }
      }
    }
  `);

  regionsQuery.data.regions.nodes.forEach((region) =&gt; {
    createPage({
      path: `/regions/${region.slug}`,
      component: path.resolve(`./src/templates/RegionPage.js`),
      context: {
        id: region.id,
      },
    });
  });
};
</code></pre>

<pre><code class="language-js">// File: src/templates/RegionPage.js
import { graphql } from "gatsby";

const RegionPage = ({ data: { region } }) =&gt; {
  return &lt;main&gt;{JSON.stringify(region, null, 2)}&lt;/main&gt;;
};

export default RegionPage;

export const query = graphql`
  query ($id: String!) {
    region: daRegion(id: { eq: $id }) {
      name
      overview
      subregions {
        name
      }
    }
  }
`;
</code></pre>

<p>&nbsp;</p>

<p>Check out the <a href="https://github.com/">Pull Request on Github</a> to view the full refactor, as the example above is somewhat simplified.</p>

<p>&nbsp;</p>

<p>All the best,<br />
Queen Raae</p>

<p>&nbsp;</p>

<p><strong>PS:</strong> The <a href="https://github.com/distributeaid/distributeaid.org">Distribute Aid project</a> is a great one to contribute to if you would like to help out or need more real-world Gatsby experience.</p>
    </div>
</article>
    </body>
</html>
