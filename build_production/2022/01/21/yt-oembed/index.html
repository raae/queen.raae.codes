<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="canonical" href="https://queen.raae.codes/2022/01/21/yt-oembed">
        <meta name="description" content="Ahoy, seasoned JavaScript developers and daring dev pirates! Join our swashbuckling crew as we embark on thrilling treasure hunts unraveling the secrets of HTML, CSS, and JavaScript, all while having a blast!">
        <title>Source YouTube information using oEmbed, no YouTube API Key needed</title>
                <link rel="stylesheet" href="/assets/build/assets/main-HrG164mN.css">
        <script defer type="module" src="/assets/build/assets/main-l0sNRNKZ.js"></script>
    </head>
    <body class="text-gray-900 font-sans antialiased">
        <article class="max-w-3xl mx-auto px-4 py-8">
    <header class="mb-8">
        <h1 class="text-4xl font-bold text-brown-900 mb-4">Source YouTube information using oEmbed, no YouTube API Key needed</h1>

        
                    <div class="mt-4 flex flex-wrap gap-2">
                                    <span class="px-3 py-1 bg-brown-100 text-brown-800 rounded-full text-sm">
                        oembed
                    </span>
                                    <span class="px-3 py-1 bg-brown-100 text-brown-800 rounded-full text-sm">
                        sourceNodes
                    </span>
                                    <span class="px-3 py-1 bg-brown-100 text-brown-800 rounded-full text-sm">
                        createNode
                    </span>
                                    <span class="px-3 py-1 bg-brown-100 text-brown-800 rounded-full text-sm">
                        createContentDigest
                    </span>
                                    <span class="px-3 py-1 bg-brown-100 text-brown-800 rounded-full text-sm">
                        createNodeId
                    </span>
                                    <span class="px-3 py-1 bg-brown-100 text-brown-800 rounded-full text-sm">
                        
                    </span>
                                    <span class="px-3 py-1 bg-brown-100 text-brown-800 rounded-full text-sm">
                        
                    </span>
                            </div>
            </header>

    <div class="prose prose-lg prose-brown max-w-none">
        <p>In yesterday's unauthorized and rum-fueled treasure hunts in the sharky waters around the Gatsby islands, we looked closely at <a href="https://youtu.be/VhrOe0X_oA8">sourcing content nodes</a> with data from the YouTube oEmbed endpoint.</p>

<p><a href="https://oembed.com/">oEmbed</a> is likely one of the most underappreciated concepts of the open web. I first encountered it when WordPress added support back in my uni days; let's just say it been awhile ðŸ‘µ</p>

<p>A simple yet powerful concept that I think would benefit from more awareness.</p>

<p><strong>Have you heard about or used oEmbed before?</strong></p>

<h2>oEmbed Examples</h2>

<p>A provider: YouTube, SoundCloud, Issuu, Flickr, or your blog provides an oEmbed endpoint that accepts at a minimum an URL and returns embeddable content in return.</p>

<p>A GET request to <code>https://www.flickr.com/services/oembed/?url=http://www.flickr.com/photos/bees/2341623661/</code> returns:</p>

<pre><code class="language-json">{
  "version": "1.0",
  "type": "photo",
  "width": 240,
  "height": 160,
  "title": "ZB8T0193",
  "url": "http://farm4.static.flickr.com/3123/2341623661_7c99f48bbf_m.jpg",
  "author_name": "Bees",
  "author_url": "http://www.flickr.com/photos/bees/",
  "provider_name": "Flickr",
  "provider_url": "http://www.flickr.com/"
}
</code></pre>

<p>Or more interestingly in our case, a GET Request to <code>https://www.youtube.com/oembed/?url=https://youtu.be/Bk1jonYPFD4</code> returns:</p>

<pre><code class="language-json">{
  "title": "Celebrating POW! (usepow.app)  \u00b7  A day in my life as a developer, founder and mom  \u00b7  March 2021",
  "author_name": "Queen Raae",
  "author_url": "https://www.youtube.com/c/QueenRaae",
  "type": "video",
  "height": 113,
  "width": 200,
  "version": "1.0",
  "provider_name": "YouTube",
  "provider_url": "https://www.youtube.com/",
  "thumbnail_height": 360,
  "thumbnail_width": 480,
  "thumbnail_url": "https://i.ytimg.com/vi/Bk1jonYPFD4/hqdefault.jpg",
  "html": "\u003ciframe width=\u0022200\u0022 height=\u0022113\u0022 src=\u0022https://www.youtube.com/embed/Bk1jonYPFD4?feature=oembed\u0022 frameborder=\u00220\u0022 allow=\u0022accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture\u0022 allowfullscreen\u003e\u003c/iframe\u003e"
}
</code></pre>

<p>Take note of <code>html</code> on the YouTube response; it's all you need to embed a YouTube player to your site.</p>

<h2>Sourcing nodes with oEmbed data</h2>

<p>In Gatsby land, we can use oEmbed to ensure we have the correct embed snippet and/or the current title for our YouTube videos.</p>

<p>We do so by using the <code>gatsby-node.js</code> hook <code>sourceNodes</code> where we create one content node per YouTube video and add the information from the oEmbed endpoint onto the node.</p>

<pre><code class="language-js">// gatsby-node.js
// Full code without error handling

const axios = require("axios");

const YOUTUBE_IDS = ["Bk1jonYPFD4", "TzJfepDjpzM"];

const fetchEmbed = async (id) =&gt; {
  const ytUrl = `https://youtu.be/${id}`;
  const { data } = await axios.get("https://www.youtube.com/oembed", {
    params: {
      url: ytUrl,
    },
  });
  return data;
};

const prepYouTubeNode = async (
  id,
  { actions: { createNode }, createNodeId, createContentDigest }
) =&gt; {
  const embedData = await fetchEmbed(id);

  createNode({
    id: createNodeId(`you-tube-${id}`),
    oEmbed: embedData,
    internal: {
      type: `YouTube`,
      contentDigest: createContentDigest(embedData),
    },
  });
};

exports.sourceNodes = async (params) =&gt; {
  await Promise.all(YOUTUBE_IDS.map((id) =&gt; prepYouTubeNode(id, params)));
};
</code></pre>

<p><strong>Would you like to see this code refactored into a plugin?</strong></p>

<p>&nbsp;<br />
All the best,<br />
Queen Raae</p>

<p>&nbsp;<br />
<strong>PS:</strong> The Pirate Princess and I woke up in this <a href="https://twitter.com/OlaHolstVea/status/1483819055584878593">magical tree top hut</a> today...</p>
    </div>
</article>
    </body>
</html>
