<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="canonical" href="https://queen.raae.codes/2022/10/22/fuzzy-xata">
        <meta name="description" content="Ahoy, seasoned JavaScript developers and daring dev pirates! Join our swashbuckling crew as we embark on thrilling treasure hunts unraveling the secrets of HTML, CSS, and JavaScript, all while having a blast!">
        <title>Fuzzy search FTW with Xata</title>
                <link rel="stylesheet" href="/assets/build/assets/main-BZO06M8j.css">
        <script defer type="module" src="/assets/build/assets/main-l0sNRNKZ.js"></script>
    </head>
    <body class="text-gray-900 font-sans antialiased">
        <article class="max-w-3xl mx-auto px-4 py-8">
    <header class="mb-8">
        <h1 class="text-4xl font-bold text-brown-900 mb-4">Fuzzy search FTW with Xata</h1>

        
            </header>

    <div class="prose prose-lg prose-brown max-w-none">
        <p>This week we explored search for "Prune your follows" on the <a href="https://youtu.be/yDxF8FUNUbI">unauthorized and rum-fueled treasure hunt</a> in the sharky waters around the Gatsby islands üè¥‚Äç‚ò†Ô∏è</p>

<p><a href="https://xata.io/">Xata</a> has search built-in. Even fuzzy search! Something that makes a dyslectic like me very happy.</p>

<p>Fuzzy search allows spelling errors by setting a fuzziness level.</p>

<aside class="notice">

**Fuzziness Level:** Maximum [Levenshtein distance](https://en.wikipedia.org/wiki/Levenshtein_distance) for the search terms. The Levenshtein distance is the number of one-character changes needed to make two strings equal. The default is 1, meaning that single-character typos per word are tolerated by search. You can set it to 0 to remove the typo tolerance or set it to 2 to allow two typos in a word.  
<cite>Xata docs.</cite>

</aside>

<p>On stream, we didn't manage to highlight the matches. We did think it was probably possible. And we were right! A Xata engineer reached out after the stream and told us how ü•≥</p>

<p><a href="https://twitter.com/raae/status/1583443888169025538"><img src="./twitter-fuzzy.jpg" alt="Highlighting Celebration Tweet" /></a></p>

<h2>The Code</h2>

<pre><code class="language-js">// Function user in server-side code,
// in our case by a Gatsby Serverless Function

export const searchFollowing = async ({ followerId, sort, search }) =&gt; {
  const results = await xata.search.all(search, {
    tables: [
      {
        table: "accounts",
        target: [
          { column: "name", weight: 7 },
          { column: "username", weight: 7 },
          { column: "meta.location" },
          { column: "meta.description" },
        ],
        filter: { followed_by: followerId },
      },
    ],
    highlight: { enabled: true },
    fuzziness: 1,
    prefix: "phrase",
  });

  return results.map((result) =&gt; {
    return {
      ...result,
      searchInfo: result.record.getMetadata(),
    };
  });
};
</code></pre>

<p>Results returned from the above function üëá</p>

<pre><code class="language-json">// Removed surplus properties for brevity
[
  {
    "table": "accounts",
    "record": {
      "name": "Xata ü¶ã Think Data, not Databases",
      "username": "xata",
      "followed_by": "4092141"
    },
    "searchInfo": {
      "highlight": {
        "followed_by": ["&lt;em&gt;4092141&lt;/em&gt;"],
        "name": ["&lt;em&gt;Xata&lt;/em&gt; ü¶ã Think &lt;em&gt;Data&lt;/em&gt;, not Databases"],
        "username": ["&lt;em&gt;xata&lt;/em&gt;"]
      },
      "score": 40.357788,
      "table": "accounts",
      "version": 15
    }
  },
  {
    // And more results
  }
]
</code></pre>

<p>And we can use the highlight property to create highlighted results.</p>

<p>For the complete code, check out the <a href="https://github.com/queen-raae/prune-your-follows/pull/19">Prune your Follows repository on Github</a>.</p>

<p>&nbsp;</p>

<p>All the best,<br />
Queen Raae</p>

<p>&nbsp;</p>

<p><strong>PS:</strong> Xata is sponsoring our rework of Prune your Follows</p>
    </div>
</article>
    </body>
</html>
