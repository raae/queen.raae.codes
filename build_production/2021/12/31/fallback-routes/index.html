<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="canonical" href="https://queen.raae.codes/2021/12/31/fallback-routes">
        <meta name="description" content="Ahoy, seasoned JavaScript developers and daring dev pirates! Join our swashbuckling crew as we embark on thrilling treasure hunts unraveling the secrets of HTML, CSS, and JavaScript, all while having a blast!">
        <title>Server Side Rendered (SSR) fallback routes with Gatsby</title>
                <link rel="stylesheet" href="/assets/build/assets/main-BZO06M8j.css">
        <script defer type="module" src="/assets/build/assets/main-l0sNRNKZ.js"></script>
    </head>
    <body class="text-gray-900 font-sans antialiased">
        <article class="max-w-3xl mx-auto px-4 py-8">
    <header class="mb-8">
        <h1 class="text-4xl font-bold text-brown-900 mb-4">Server Side Rendered (SSR) fallback routes with Gatsby</h1>

        
                    <div class="mt-4 flex flex-wrap gap-2">
                                    <span class="px-3 py-1 bg-brown-100 text-brown-800 rounded-full text-sm">
                        SSR
                    </span>
                                    <span class="px-3 py-1 bg-brown-100 text-brown-800 rounded-full text-sm">
                        SSG
                    </span>
                                    <span class="px-3 py-1 bg-brown-100 text-brown-800 rounded-full text-sm">
                        getServerData
                    </span>
                                    <span class="px-3 py-1 bg-brown-100 text-brown-800 rounded-full text-sm">
                        
                    </span>
                            </div>
            </header>

    <div class="prose prose-lg prose-brown max-w-none">
        <p>The unauthorized and rum-fueled treasure hunts in the sharky waters around the Gatsby islands Conference Buddy edition is back.</p>

<p>And on <a href="https://youtu.be/d834JE_bFog">yesterday's stream</a> helping Mirjam source conference data from Supabase, we briefly touched on fallback routes.</p>

<p><a href="https://youtu.be/d834JE_bFog"><img src="./yt-screenshot.jpg" alt="Screengrab of the intro" /></a></p>

<h2>What are fallback routes?</h2>

<p>It's a way to render pages for data that Gatsby does not yet sourced.</p>

<p>In Mirjam's case with Conference Buddy there will be a period between a user submits a conference and a fresh build picks up the conference for static generation.</p>

<p>In that interim time, we can rely on fallback routes using either CSR (Client Side Rendering) or SSR (Server Side Rendering).</p>

<p>I was not sure if SSR fallback route would be allowed, so I spun up a contrived demo using SSG (Static Site Generation) for sourced YouTube videos and SSR for non-sourced YouTube videos.</p>

<p>The Gatsby docs does not mention SSR for fallback routes, but it builds and serves locally on my machine. However I must admit I have not yet tested deployment...</p>

<h3>SSG Page Code</h3>

<pre><code class="language-js">// src/pages/yt/{youTubeEmbed.id}.js

import React from "react";
import { graphql } from "gatsby";

import VideoLayout from "../../components/video-layout";

const SSGVideoPage = ({ data }) =&gt; {
  return &lt;VideoLayout {...data.youTubeEmbed} /&gt;;
};

export default SSGVideoPage;

export const query = graphql`
  query ($id: String) {
    youTubeEmbed(id: { eq: $id }) {
      title
      html
    }
  }
`;
</code></pre>

<h3>Fallback SSR Page Code</h3>

<pre><code class="language-js">// src/pages/yt/[youTubeId].js

import React from "react";

import { fetchEmbed } from "../../services/oembed";
import VideoLayout from "../../components/video-layout";
import NotFoundPage from "../404";

const SSRVideoPage = ({ serverData }) =&gt; {
  if (serverData) {
    return &lt;VideoLayout {...serverData} /&gt;;
  } else {
    return &lt;NotFoundPage /&gt;;
  }
};

export default SSRVideoPage;

export async function getServerData({ params }) {
  console.log("SERVER SIDE RENDERING Page for ", params.youTubeId);

  const embedData = await fetchEmbed(params.youTubeId, console);

  return {
    props: embedData,
  };
}
</code></pre>

<h2>Links</h2>

<ul>
<li>Gatsby's official documentation on <a href="https://www.gatsbyjs.com/docs/reference/routing/file-system-route-api/#collection-route--fallback">Fallback Routes</a></li>
<li>The contrived example on <a href="https://codesandbox.io/s/demo-ssr-fallback-route-9pteu?file=/src/pages/index.mdx">CodeSandbox</a> (CodeSandbox is a little buggy with Gatsby so give it some time/reloads if its messing up...)</li>
</ul>

<p>&nbsp;<br />
Have you ever used fallback routes in a real-world project?</p>

<p>&nbsp;<br />
All the best,<br />
Queen Raae</p>

<p>&nbsp;<br />
<strong>PS:</strong> Godt Nytt Ã…r (Happy New Year) ðŸŽ‡</p>
    </div>
</article>
    </body>
</html>
