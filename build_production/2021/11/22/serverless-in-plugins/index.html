<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="canonical" href="https://queen.raae.codes/2021/11/22/serverless-in-plugins">
        <meta name="description" content="Ahoy, seasoned JavaScript developers and daring dev pirates! Join our swashbuckling crew as we embark on thrilling treasure hunts unraveling the secrets of HTML, CSS, and JavaScript, all while having a blast!">
        <title>Gatsby Serverless Functions inside Gatsby Plugins</title>
                <link rel="stylesheet" href="/assets/build/assets/main-HrG164mN.css">
        <script defer type="module" src="/assets/build/assets/main-l0sNRNKZ.js"></script>
    </head>
    <body class="text-gray-900 font-sans antialiased">
        <article class="max-w-3xl mx-auto px-4 py-8">
    <header class="mb-8">
        <h1 class="text-4xl font-bold text-brown-900 mb-4">Gatsby Serverless Functions inside Gatsby Plugins</h1>

        
            </header>

    <div class="prose prose-lg prose-brown max-w-none">
        <p><strong>Did you know Gatsby Plugins can contain Gatsby Serverless Functions?</strong></p>

<p><img src="./demo.jpg" alt="Screengrab showing a /api/hello endpoint coming from the demo site and a /api/@raae/gatsby-plugin-donations/hello endpoint coming from the plugin" title="Demo" /></p>

<p>Since Kyle made an off handed comment about it on our <a href="https://youtu.be/gG9E7ZYbhGo">unauthorized and rum-fueled treasure hunt</a> in the sharky waters around the Gatsby islands" back in June, I have been meaning to check it out.</p>

<p>Last week I finally had the time and the use case for exploring ðŸŽ‰</p>

<p>Two things tripped me up:</p>

<ul>
<li>The structure of the API-folder</li>
<li>Plugin options are not available</li>
</ul>

<p>Let's take a close look, so you do not have to trip up as well.</p>

<h2>The structure of the api-folder</h2>

<p>For your plugin's functions to be picked up, they must live inside a folder structure mirroring the plugin's name, not directly in the api-folder as I assumed.</p>

<p>For a scoped plugin such as mine:</p>

<pre><code>src/
â”œâ”€ api/
â”‚  â”œâ”€ @raae/
â”‚  â”‚  â”œâ”€ gatsby-plugin-donations/
â”‚  â”‚  â”‚  â”œâ”€ hello.js
</code></pre>

<p>For a non-scoped plugin:</p>

<pre><code>src/
â”œâ”€ api/
â”‚  â”œâ”€ gatsby-plugin-donations/
â”‚  â”‚  â”œâ”€ hello.js

</code></pre>

<p>Plugin options are not available</p>

<p>Plugins are meant to be configured using plugin options, but there is no way to get access to those options from a Gatsby Plugin Function ðŸ˜¿</p>

<p>This feels like an oversight to me....</p>

<p>You can read the Twitter <a href="https://twitter.com/raae/status/1460649528202305541?s=20">discussion I had with Kyle</a> about it. It ended withh him suggesting I create an issue.</p>

<p><a href="https://twitter.com/raae/status/1460649528202305541?s=20"><img src="./tweet.jpg" alt="Haven't the convention been to add secrets as plugin options?
Getting them from env vars of course. So that a plugin does not &quot;own&quot; any env vars. " title="Screengrab of Tweet" /></a></p>

<p>So I did, or more correctly, I started a discussion under <a href="https://github.com/gatsbyjs/gatsby/discussions/34047">Ideas / Feature Requests</a>. Go upvote and add your thoughts!!</p>

<p>But for the time being, Gatsby Functions inside Gatsby Plugins will have to rely on env variables to be configured.</p>

<p>All the best,<br />
Queen Raae</p>

<p><strong>â€‹PS:</strong> Yes, I am working on a donations with Stripe plugin. Work in progress can be <a href="https://github.com/queen-raae/gatsby-plugin-donations/pull/6">found on Github</a>. I am looking for beta testers! Is that you?</p>
    </div>
</article>
    </body>
</html>
