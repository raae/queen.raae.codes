---
import BaseLayout from "../layouts/BaseLayout.astro";
import SiteHeader from "../components/SiteHeader.astro";
import PageSection from "../components/PageSection.astro";
import PageSectionHeader from "../components/PageSectionHeader.astro";
import Prose from "../components/Prose.astro";
import ContentList from "../components/ContentList.astro";
import Newsletter from "../components/Newsletter.astro";
import { getAllPosts, getAuthorInfo } from "../lib/posts";
import { getEntry } from "astro:content";

// Get landing page content
const landing = await getEntry("landing", "index");
const { Content } = await landing.render();

// Get latest posts
const allPosts = await getAllPosts();
const latestPosts = allPosts.slice(0, 10);

// Treasures â€” shown between first 3 posts and the rest
const treasures = [
  {
    primary: "Is it Queen or AI?",
    to: "/is-it-queen-or-ai",
    secondary: "ğŸ® Quiz Game Â· Jean-Claw ğŸ¦€",
  },
  {
    primary: "Jean-Claw â€” AI Chief of Operations",
    to: "/author/jeanclaw/",
    secondary: "ğŸ¤– AI Agent Â· Queen Raae ğŸ‘‘",
  },
  {
    primary: "POW! â€” A Menstrual Journal",
    href: "https://pow.no",
    secondary: "ğŸ’ª Side Project Â· Queen Raae ğŸ‘‘",
  },
  {
    primary: "Slow & Steady Podcast",
    href: "https://slowandsteadypodcast.com/",
    secondary: "ğŸ™ï¸ Podcast Â· with Benedikt Deicke",
  },
  {
    primary: "Book Queen Raae as a Speaker",
    to: "/speaker/",
    secondary: "ğŸ¤ Speaking Â· Queen Raae ğŸ‘‘",
  },
];

// Convert posts to feed items with uniform format
const postItems = latestPosts.map((post) => {
  const authorInfo = getAuthorInfo(post.author);
  return {
    primary: post.title,
    to: post.slug,
    secondary: `ğŸ“ Blog Post Â· ${post.dateFormatted} Â· ${authorInfo.name} ${authorInfo.emoji}`,
  };
});

// 3 latest posts, then treasures, then remaining posts
const feedItems = [
  ...postItems.slice(0, 3),
  ...treasures,
  ...postItems.slice(3),
];

const { badge, title } = landing.data;
---

<BaseLayout title={title}>
  <SiteHeader />
  <main class="pb-12">
    <!-- Welcome Section -->
    <PageSection component="header">
      <PageSectionHeader badge={badge} title={title} hLevel={1} />
      <Prose>
        <Content />
      </Prose>
    </PageSection>

    <!-- Newsletter Section -->
    <PageSection>
      <Newsletter />
    </PageSection>

    <!-- Mixed Feed Section -->
    <PageSection>
      <ContentList items={feedItems} ctas={[{ to: "/posts/", label: "All posts..." }]} />
    </PageSection>
  </main>
</BaseLayout>
